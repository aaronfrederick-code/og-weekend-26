<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OG Weekend 2026</title>
    <!-- We're using Tailwind CSS for styling, loaded from a CDN --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- We're using Lucide for icons --><script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Configuration for Tailwind --><script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: { // Blue
                            DEFAULT: '#2563EB', // blue-600
                            dark: '#1D4ED8',    // blue-700
                            light: '#DBEAFE',   // blue-100
                            text: '#1E4ED8'     // blue-700
                        },
                        'primary-red': { // Red
                            DEFAULT: '#DC2626', // red-600
                            dark: '#B91C1C',    // red-700
                            light: '#FEE2E2',   // red-100
                            text: '#B91C1C'     // red-700
                        },
                        'primary-green': { // Green
                            DEFAULT: '#059669', // emerald-600
                            dark: '#047857',    // emerald-700
                            light: '#D1FAE5',   // emerald-100
                            text: '#065F46'     // emerald-800
                        },
                        'primary-gold': { // Gold
                            DEFAULT: '#F59E0B', // amber-500
                            dark: '#D97706',    // amber-600
                            light: '#FEF3C7',   // amber-100
                            text: '#92400E'     // amber-800
                        },
                        'primary-navy': { // Navy
                            DEFAULT: '#172554', // slate-900
                            dark: '#1e3a8a',    // blue-900
                            light: '#dbeafe',   // blue-100
                            text: '#1e3a8a'     // blue-900
                        },
                        light: '#f1f5f9', // slate-100
                    }
                }
            }
        }
    </script>
    
    <style>
        /* --- ✨ New Fullscreen Background --- */
        body {
            /* Ensure z-index stacking context */
            isolation: isolate;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            z-index: -10;
            /* Reverted to the original, softer image */
            background-image: url('https://images.unsplash.com/photo-1535131749006-b7f58c99034b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80');
            background-size: cover;
            background-position: center;
            /* Add a blur and darken for readability */
            filter: blur(4px);
            background-color: rgba(0, 0, 0, 0.4); /* Dark overlay */
        }
        /* --- End Fullscreen Background --- */

        /* Simple icon replacement class for lucide */
        .icon {
            display: inline-block;
            width: 1.25em;
            height: 1.25em;
            stroke-width: 2;
            vertical-align: middle;
        }

        /* --- Itinerary Timeline --- */
        .itinerary-day {
            position: relative;
            padding-left: 2.5rem; 
        }
        .itinerary-day::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.35rem; 
            width: 1.25rem;
            height: 1.25rem;
            background-color: #fff;
            border: 4px solid #2563EB; 
            border-radius: 50%;
            z-index: 10;
        }
        .itinerary-day::after {
            content: '';
            position: absolute;
            left: 0.525rem; 
            top: 1.6rem; 
            bottom: -1.5rem; 
            width: 3px;
            background-image: linear-gradient(to bottom, #2563EB 60%, transparent 40%);
            background-size: 100% 10px;
            background-repeat: repeat-y;
            opacity: 0.4;
            z-index: 5;
        }
        .itinerary-day:last-child::after { display: none; }

        /* --- Gemini Modal & Loader --- */
        .gemini-modal { transition: opacity 0.25s ease; }
        .gemini-modal-content {
            transition: transform 0.25s ease, border-top-color 0.3s ease;
            border-top: 4px solid #2563EB; /* Default blue */
        }
        .loader {
            border: 4px solid #f1f5f9; /* slate-100 */
            border-top: 4px solid #2563EB; /* Default blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- ✨ New AI Concierge Chat --- */
        #chat-messages { height: 28rem; }
        .chat-message {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            max-width: 80%;
            line-height: 1.6;
        }
        .user-message {
            background-color: #DBEAFE; 
            color: #1E3A8A;
            align-self: flex-end;
            margin-left: auto;
        }
        .ai-message {
            background-color: #f1f5f9; 
            color: #334155;
            align-self: flex-start;
            margin-right: auto;
        }
        .ai-message strong { color: #1E4ED8; }
        .ai-message .sources-list {
            font-size: 0.875rem;
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid #cbd5e1;
        }
        .error-message {
            background-color: #FEE2E2;
            color: #991B1B;
            align-self: flex-start;
            margin-right: auto;
        }
        .typing-indicator {
            align-self: flex-start;
            margin-right: auto;
            color: #64748b;
            font-style: italic;
        }

        /* --- ✨ New Color Themeing Rules --- */

        /* Theme: Itinerary (Green) */
        #itinerary .itinerary-day::before { border-color: #059669; }
        #itinerary .itinerary-day::after { background-image: linear-gradient(to bottom, #059669 60%, transparent 40%); }

        /* Theme: AI Concierge (Gold) */
        #concierge .ai-message strong { color: #D97706; }

        /* Active Tab Button Theming */
        .tab-button.active-tab { font-weight: 600; }
        .tab-button.active-tab[data-tab-target="#booking"] { background-color: #2563EB; color: white; }
        .tab-button.active-tab[data-tab-target="#tools"] { background-color: #DC2626; color: white; }
        .tab-button.active-tab[data-tab-target="#itinerary"] { background-color: #059669; color: white; }
        .tab-button.active-tab[data-tab-target="#concierge"] { background-color: #F59E0B; color: black; }
        .tab-button.active-tab[data-tab-target="#gallery"] { background-color: #172554; color: white; }

        /* Modal Theming (via body data-attribute) */
        
        /* Red Theme (Trip Tools) */
        body[data-theme="red"] .gemini-modal-content { border-top-color: #DC2626; }
        body[data-theme="red"] #modal-title { color: #DC2626; }
        body[data-theme="red"] #modal-prompt-submit { background-color: #DC2626; color: white; }
        body[data-theme="red"] #modal-prompt-submit:hover { background-color: #B91C1C; }
        body[data-theme="red"] .loader { border-top-color: #DC2626; }
        
        /* Green Theme (Itinerary) */
        body[data-theme="green"] .gemini-modal-content { border-top-color: #059669; }
        body[data-theme="green"] #modal-title { color: #059669; }
        body[data-theme="green"] #modal-prompt-submit { background-color: #059669; color: white; }
        body[data-theme="green"] #modal-prompt-submit:hover { background-color: #047857; }
        body[data-theme="green"] .loader { border-top-color: #059669; }
        
        /* Gold Theme (Concierge) */
        body[data-theme="gold"] .gemini-modal-content { border-top-color: #F59E0B; }
        body[data-theme="gold"] #modal-title { color: #F59E0B; }
        body[data-theme="gold"] #modal-prompt-submit { background-color: #F59E0B; color: black; }
        body[data-theme="gold"] #modal-prompt-submit:hover { background-color: #D97706; }
        body[data-theme="gold"] .loader { border-top-color: #F59E0B; }

        /* Navy Theme (Gallery) */
        body[data-theme="navy"] .gemini-modal-content { border-top-color: #172554; }
        body[data-theme="navy"] #modal-title { color: #172554; }
        body[data-theme="navy"] #modal-prompt-submit { background-color: #172554; color: white; }
        body[data-theme="navy"] #modal-prompt-submit:hover { background-color: #1e3a8a; }
        body[data-theme="navy"] .loader { border-top-color: #172554; }

        /* Blue Theme (Booking) - Default */
        body[data-theme="blue"] .gemini-modal-content { border-top-color: #2563EB; }
        body[data-theme="blue"] #modal-title { color: #2563EB; }
        body[data-theme="blue"] #modal-prompt-submit { background-color: #2563EB; color: white; }
        body[data-theme="blue"] #modal-prompt-submit:hover { background-color: #1D4ED8; }
        body[data-theme="blue"] .loader { border-top-color: #2563EB; }

        /* --- ✨ New Text Shadow Rules for Readability --- */
        header h1, header p {
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
        }
        footer p {
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
        }

        /* --- ✨ New Carousel Styles --- */
        .carousel-thumbnail {
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s ease;
            border: 4px solid transparent;
        }
        .carousel-thumbnail:hover {
            opacity: 0.8;
        }
        .carousel-thumbnail.active {
            opacity: 1;
            border-color: #172554; /* primary-navy-DEFAULT */
        }
        /* Style for the new upload button */
        #upload-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

    </style>
</head>
<!-- Removed bg-slate-50 --><body class="text-slate-700">

    <!-- Header Section - Removed bg image and overlay, now just a container for text --><header class="relative flex items-center justify-center h-64">
        <div class="relative text-white text-center p-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">OG Weekend 2026</h1>
            <p class="text-xl md:text-2xl opacity-90">February 5th - February 8th, 2026</p>
        </div>
    </header>

    <!-- Main Content Area --><main class="max-w-4xl mx-auto p-4 md:p-8">

        <!-- ✨ Tab Navigation - Added frosted glass effect & updated grid --><div class="mb-8 grid grid-cols-3 md:grid-cols-5 gap-1 rounded-xl bg-slate-200/50 backdrop-blur-sm p-1">
            <!-- Add 'active-tab' class to the first button by default --><button data-tab-target="#booking" class="tab-button active-tab w-full text-center py-3 px-4 rounded-lg transition-all duration-300">
                Booking Info
            </button>
            <button data-tab-target="#tools" class="tab-button text-slate-700 hover:bg-slate-300 w-full text-center py-3 px-4 rounded-lg transition-all duration-300">
                Trip Tools
            </button>
            <button data-tab-target="#itinerary" class="tab-button text-slate-700 hover:bg-slate-300 w-full text-center py-3 px-4 rounded-lg transition-all duration-300">
                Itinerary
            </button>
            <button data-tab-target="#concierge" class="tab-button text-slate-700 hover:bg-slate-300 w-full text-center py-3 px-4 rounded-lg transition-all duration-300">
                ABBA
            </button>
            <button data-tab-target="#gallery" class="tab-button text-slate-700 hover:bg-slate-300 w-full text-center py-3 px-4 rounded-lg transition-all duration-300">
                Gallery
            </button>
        </div>

        <!-- ✨ Tab Content --><div id="tab-content">
            <!-- Booking Information Card (Blue Theme) - Added frosted glass effect --><section id="booking" class="tab-panel bg-white/90 backdrop-blur-sm rounded-xl shadow-lg mb-12 overflow-hidden transition-all duration-300 hover:shadow-xl">
                <div class="p-6 md:p-8">
                    <!-- Using slate-200 for border --><h2 class="text-3xl font-semibold mb-6 pb-4 border-b border-slate-200 text-slate-900">
                        Booking Information
                    </h2>
                    
                    <!-- Lodging --><div class="mb-6">
                        <h3 class="text-2xl font-semibold mb-3 flex items-center">
                            <i data-lucide="home" class="icon mr-3 text-primary"></i>
                            Lodging
                        </h3>
                        <p class="text-lg text-slate-700 mb-4"><strong>Airbnb in Montgomery</strong></p>
                        <!-- Updated button style --><a href="https://www.airbnb.com/rooms/626832094255090711" target="_blank" class="inline-flex items-center bg-primary text-white font-semibold py-3 px-5 rounded-lg shadow-md hover:bg-primary-dark transition-all duration-300 ease-in-out">
                            <i data-lucide="link-2" class="icon mr-2"></i>
                            View Airbnb Listing
                        </a>
                    </div>

                    <!-- Flights --><div class="mb-6">
                        <h3 class="text-2xl font-semibold mb-3 flex items-center">
                            <i data-lucide="plane" class="icon mr-3 text-primary"></i>
                            Flights
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-lg text-slate-700 font-semibold">Arrival (2/5):</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Flight:</strong> AA 5017</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Departs DFW:</strong> 11:00 AM</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Arrives MGM:</strong> 12:55 PM</p>
                            </div>
                            <div>
                                <p class="text-lg text-slate-700 font-semibold">Departure (2/8):</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Flight:</strong> AA 5077</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Departs MGM:</strong> 1:25 PM</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Arrives DFW:</strong> 3:50 PM</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <!-- Updated button style --><a href="https://www.google.com/travel/flights/booking?tfs=CBwQAhpFEgoyMDI2LTAyLTA1IiAKA0RGVxIKMjAyNi0wMi0wNRoDTUdNKgJBQTIENTAxN2oMCAISCC9tLzBmMnJxcgcIARIDTUdNGkUSCjIwMjYtMDItMDgiIAoDTUdNEgoyMDI2LTAyLTA4GgNERlcqAkFBMgQ1MDc3agcIARIDTUdNcgwIAhIIL2m/MGYycnFAAUgBcAGCAQsI____________AZgBAQ&tfu=CmxDalJJU1hBeWJWTTFWWEIwVXpoQlFXWmhibEZDUnkwdExTMHRMUzB0TFc5NVkyMDBNa0ZCUVVGQlIybzFWVkZKVGt4SVYyTkJFZ1pCUVRVd056Y2FDd2l4MEFJUUFob0RWVk5FT0J4d3NkQUMSBggAIAEoAiIGCgEwCgEx&hl=en&gl=US&curr=USD" target="_blank" class="inline-flex items-center bg-primary text-white font-semibold py-3 px-5 rounded-lg shadow-md hover:bg-primary-dark transition-all duration-300 ease-in-out">
                                <i data-lucide="link-2" class="icon mr-2"></i>
                                View Google Flights Booking
                            </a>
                        </div>
                    </div>

                    <!-- Car Rental --><div>
                        <h3 class="text-2xl font-semibold mb-3 flex items-center">
                            <i data-lucide="car" class="icon mr-3 text-primary"></i>
                            Car Rental
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-lg text-slate-700 font-semibold">Vehicle:</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Enterprise:</strong> 7-Passenger Mini-Van</p>
                                <p class="text-lg text-slate-700 pl-4">(Chrysler Pacifica or similar)</p>
                                <p class="text-lg text-slate-700 pl-4"><strong class="text-primary-dark">Confirmation:</strong> 1588667854</p>
                            </div>
                            <div>
                                <p class="text-lg text-slate-700 font-semibold">Pick-up (2/5):</p>
                                <p class="text-lg text-slate-700 pl-4">3:30 PM @ MGM Airport</p>
                                <p class="text-lg text-slate-700 font-semibold mt-2">Drop-off (2/8):</p>
                                <p class="text-lg text-slate-700 pl-4">11:00 AM @ MGM Airport</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <!-- Updated button style --><a href="https://mail.google.com/mail/u/1/#inbox/FMfcgzQcqQzRTCHKFPRTPgbVCWjtzxWT" target="_blank" class="inline-flex items-center bg-primary text-white font-semibold py-3 px-5 rounded-lg shadow-md hover:bg-primary-dark transition-all duration-300 ease-in-out">
                                <i data-lucide="mail" class="icon mr-2"></i>
                                View Confirmation Email
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ✨ --- RESTORED SECTIONS --- ✨ -->

            <!-- ✨ New Gemini Trip Tools Card (Red Theme) - Added frosted glass effect --><section id="tools" class="tab-panel hidden bg-white/90 backdrop-blur-sm rounded-xl shadow-lg mb-12 overflow-hidden transition-all duration-300 hover:shadow-xl">
                <div class="p-6 md:p-8">
                    <h2 class="text-3xl font-semibold mb-6 pb-4 border-b border-slate-200 text-slate-900">
                        Trip Tools
                    </h2>
                    
                    <div class="mb-6">
                        <h3 class="text-2xl font-semibold mb-3 flex items-center">
                            <i data-lucide="sparkles" class="icon mr-3 text-primary-red-DEFAULT"></i>
                            AI Packing List
                        </h3>
                        <p class="text-lg text-slate-700 mb-4">Not sure what to pack? Let AI generate a custom list for your trip.</p>
                        <!-- Updated AI button style to RED - Lighter shade --><button id="generate-packing-list" class="inline-flex items-center bg-primary-red-light text-primary-red-text font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-primary-red-DEFAULT hover:text-white transition-all duration-300 ease-in-out transform hover:scale-105">
                            <i data-lucide="sparkles" class="icon mr-2"></i>
                            ✨ Generate Packing List
                        </button>
                    </div>
                </div>
            </section>


            <!-- Itinerary Card (Green Theme) - Added frosted glass effect --><section id="itinerary" class="tab-panel hidden bg-white/90 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">
                <!-- Add 'relative' class here to contain the timeline elements --><div class="p-6 md:p-8 relative">
                    <h2 class="text-3xl font-semibold mb-6 pb-4 border-b border-slate-200 text-slate-900">
                        Itinerary
                    </h2>
                    
                    <!-- Thursday --><div class="itinerary-day mb-6 pb-6 border-b border-slate-200">
                        <h4 class="text-2xl font-semibold mb-3 text-slate-900">Thursday, Feb 5</h4>
                        <ul class="list-disc list-inside text-lg text-slate-700 space-y-2">
                            <li>Arrive in Montgomery (MGM) @ 12:55 PM</li>
                            <li>Pick up groceries</li>
                            <li>Head to Airbnb and get settled</li>
                            <li>Go to dinner</li>
                            <!-- ✨ New Gemini Dinner Suggestion Button --><li class="list-none mt-3">
                                <!-- Updated AI button style to GREEN - Lighter shade --><button id="generate-dinner-ideas" class="inline-flex items-center bg-primary-green-light text-primary-green-text font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-primary-green-DEFAULT hover:text-white transition-all duration-300 ease-in-out transform hover:scale-105">
                                    <i data-lucide="sparkles" class="icon mr-2"></i>
                                    ✨ Suggest Dinner Spots
                                </button>
                            </li>
                            <li>Watch Mavericks vs. Spurs @ 7:30 PM -- Will Kyrie be back?!</li>
                        </ul>
                        
                        <!-- Thursday Images --><div class="mt-4 space-y-4">
                            <!-- Airbnb Images --><div class="grid grid-cols-2 gap-4">
                                <img src="https://a0.muscache.com/im/pictures/miso/Hosting-626832094255090711/original/81adfabb-b218-4c02-8afd-7b5a2d7e253a.jpeg?im_w=1440" 
                                    alt="View of the Airbnb" 
                                    class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                    onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">    
                                <img src="https://a0.muscache.com/im/pictures/371927eb-42d2-465b-8d41-9a1c92106612.jpg?im_w=1440" 
                                    alt="View of Airbnb2" 
                                    class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                    onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </div>
                            <!-- Mavs Images --><div class="grid grid-cols-2 gap-4">
                                <img src="https://images2.minutemediacdn.com/image/upload/c_crop,x_1170,y_0,w_4520,h_2542/c_fill,w_680,ar_16:9,f_auto,q_auto,g_auto/images/ImagnImages/mmsport/dallas_basketball/01k84q2r3jyreb94kfpg.jpg" 
                                    alt="View of the Dallas Mavs" 
                                    class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                    onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">    
                                <img src="https://www.vmcdn.ca/f/files/shared/feeds/cp/2024/03/20240317180328-65f76ef1f3c80c0a0c027409jpeg.jpg;w=1200;h=800;mode=crop" 
                                    alt="View of Kyrie Game Winner" 
                                    class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                    onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </div>
                        </div>
                    </div>

                    <!-- Friday --><div class="itinerary-day mb-6 pb-6 border-b border-slate-200">
                        <h4 class="text-2xl font-semibold mb-3 text-slate-900">Friday, Feb 6</h4>
                        <ul class="list-disc list-inside text-lg text-slate-700 space-y-2">
                            <li><strong>Morning:</strong> Head to Capitol Hill (Robert Trent Jones Golf)</li>
                            <li>Play 36 holes at Legislator (Tee times: 8:10 AM & 1:10 PM)</li>
                            <li><strong>Evening:</strong> Go back to the Airbnb, make dinner, and hang out</li>
                        </ul>
                        <!-- ✨ New Caddy Button for Friday --><div class="mt-4 flex flex-wrap gap-4">
                            <!-- Updated AI button style to GREEN - Lighter shade --><button id="caddy-legislator" class="inline-flex items-center bg-primary-green-light text-primary-green-text font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-primary-green-DEFAULT hover:text-white transition-all duration-300 ease-in-out transform hover:scale-105">
                                <i data-lucide="sparkles" class="icon mr-2"></i>
                                ✨ Legislator Caddy Tips
                            </button>
                            <!-- ✨ New "Ask" Button - secondary style --><button id="caddy-ask-legislator" class="inline-flex items-center bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-slate-300 transition-all duration-300 ease-in-out">
                                <i data-lucide="help-circle" class="icon mr-2"></i>
                                Ask Legislator Caddy...
                            </button>
                        </div>
                        <!-- Friday Golf Images --><div class="grid grid-cols-2 gap-4 mt-4">
                            <a href="https://www.rtjgolf.com/capitolhill/" target="_blank" rel="noopener noreferrer">
                                <img src="https://www.rtjgolf.com/img/sm-ch-l.jpg" 
                                     alt="View of the Legislator Course" 
                                     class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                     onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </a>
                            <a href="https://www.rtjgolf.com/capitolhill/" target="_blank" rel="noopener noreferrer">
                                <img src="https://www.rtjgolf.com/img/sm-ch-l.jpg" 
                                     alt="View of the Legislator Course" 
                                     class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                     onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </a>
                        </div>
                    </div>

                    <!-- Saturday --><div class="itinerary-day mb-6 pb-6 border-b border-slate-200">
                        <h4 class="text-2xl font-semibold mb-3 text-slate-900">
                            Saturday, Feb 7 
                            <span class="text-lg font-normal text-slate-500 italic ml-2">-- Rinse and Repeat, baby</span>
                        </h4>
                        <ul class="list-disc list-inside text-lg text-slate-700 space-y-2">
                            <li><strong>Morning:</strong> Head to Capitol Hill (Robert Trent Jones Golf)</li>
                            <li>Play 36 holes at Senator (Tee times: 8:00 AM & 1:00 PM)</li>
                            <li><strong>Evening:</strong> Go back to the Airbnb, make dinner, and hang out</li>
                        </ul>
                        <!-- ✨ New Caddy Button for Saturday --><div class="mt-4 flex flex-wrap gap-4">
                            <!-- Updated AI button style to GREEN - Lighter shade --><button id="caddy-senator" class="inline-flex items-center bg-primary-green-light text-primary-green-text font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-primary-green-DEFAULT hover:text-white transition-all duration-300 ease-in-out transform hover:scale-105">
                                <i data-lucide="sparkles" class="icon mr-2"></i>
                                ✨ Senator Caddy Tips
                            </button>
                            <!-- ✨ New "Ask" Button - secondary style --><button id="caddy-ask-senator" class="inline-flex items-center bg-slate-200 text-slate-800 font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-slate-300 transition-all duration-300 ease-in-out">
                                <i data-lucide="help-circle" class="icon mr-2"></i>
                                Ask Senator Caddy...
                            </button>
                        </div>
                        <!-- Saturday Golf Images --><div class="grid grid-cols-2 gap-4 mt-4">
                            <a href="https://www.rtjgolf.com/capitolhill/" target="_blank" rel="noopener noreferrer">
                                <img src="https://www.rtjgolf.com/img/sm-ch-s.jpg" 
                                     alt="View of the Senator Course" 
                                     class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-30Main
                                     onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </a>
                            <a href="https://www.rtjgolf.com/capitolhill/" target="_blank" rel="noopener noreferrer">
                                <img src="https://www.rtjgolf.com/img/sm-ch-s.jpg" 
                                     alt="View of the Senator Course" 
                                     class="w-full h-auto rounded-xl shadow-lg aspect-video object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                                     onerror="this.src='https://placehold.co/600x400/eeeeee/999999?text=Replace+Image+URL'; this.onerror=null;">
                            </a>
                        </div>
                    </div>

                    <!-- Sunday --><div class="itinerary-day mb-6">
                        <h4 class="text-2xl font-semibold mb-3 text-slate-900">Sunday, Feb 8</h4>
                        <ul class="list-disc list-inside text-lg text-slate-700 space-y-2">
                            <li>Make breakfast at the Airbnb</li>
                            <li>Pack up and leave for the airport</li>
                            <li>Head home!</li>
                        </ul>
                    </div>

                </div>
            </section>

            <!-- ✨ New AI Concierge Card (Gold Theme) - Added frosted glass effect --><section id="concierge" class="tab-panel hidden bg-white/90 backdrop-blur-sm rounded-xl shadow-lg mb-12 overflow-hidden transition-all duration-300 hover:shadow-xl">
                <div class="p-6 md:p-8">
                    <h2 class="text-3xl font-semibold mb-6 pb-4 border-b border-slate-200 text-slate-900">
                        ABBA
                    </h2>
                    <p class="text-lg text-slate-700 mb-4">Have questions? Ask your personal AI concierge about Montgomery, the golf courses, or anything else.</p>
                    
                    <!-- Chat UI --><div class="flex flex-col space-y-4">
                        <!-- Chat Messages Window --><div id="chat-messages" class="w-full bg-slate-50/80 rounded-xl border border-slate-200 p-4 flex flex-col space-y-3 overflow-y-auto">
                            <!-- Initial AI Message --><div class="chat-message ai-message">
                                Hello! I'm ABBA, your AI concierge for the OG Weekend. Think of me as your fifth OG... if you'll have me. How can I help you with your trip?
                            </div>
                            <!-- Messages will be injected here --></div>
                        
                        <!-- Chat Input Area --><div id="chat-input-area" class="flex items-center space-x-3">
                            <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-1 w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary-gold-DEFAULT focus:outline-none transition-all">
                            <!-- Updated button style to GOLD --><button id="chat-submit" class="inline-flex items-center justify-center bg-primary-gold-DEFAULT text-black font-semibold py-3 px-5 rounded-lg shadow-md hover:bg-primary-gold-dark transition-all duration-300 ease-in-out">
                                <i data-lucide="send" class="icon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ✨ --- END OF RESTORED SECTIONS --- ✨ -->

            <!-- ✨ New Gallery Card (Navy Theme) - Updated with Upload Feature --><section id="gallery" class="tab-panel hidden bg-white/90 backdrop-blur-sm rounded-xl shadow-lg mb-12 overflow-hidden transition-all duration-300 hover:shadow-xl">
                <div class="p-6 md:p-8">
                    <h2 class="text-3xl font-semibold mb-6 pb-4 border-b border-slate-200 text-slate-900">
                        Gallery
                    </h2>
                    
                    <!-- ✨ New Upload UI -->
                    <div class="flex items-center space-x-4 mb-4">
                        <!-- Updated button style to NAVY --><button id="upload-button" class="inline-flex items-center bg-primary-navy-DEFAULT text-white font-semibold py-3 px-5 rounded-lg shadow-md hover:bg-primary-navy-dark transition-all duration-300 ease-in-out">
                            <i data-lucide="upload-cloud" class="icon mr-2"></i>
                            Upload Photo
                        </button>
                        <input type="file" id="file-input" accept="image/*" class="hidden">
                        <span id="upload-status" class="text-sm text-slate-700"></span>
                    </div>

                    <!-- Carousel & Thumbnails -->
                    <div class="space-y-4">
                        <!-- Placeholder for empty gallery --><div id="gallery-placeholder" class="hidden text-center text-slate-600 py-10">
                            <i data-lucide="image-off" class="w-16 h-16 mx-auto mb-4 text-slate-400"></i>
                            <h3 class="text-xl font-semibold">No photos yet</h3>
                            <p class="text-slate-500">Upload the first photo to start the gallery!</p>
                        </div>
                        
                        <!-- Main Image Display --><div id="carousel-container" class="relative w-full bg-slate-200 rounded-xl overflow-hidden aspect-video hidden">
                            <img id="carousel-image" src="" alt="Main gallery image" class="w-full h-full object-cover transition-opacity duration-300">
                            
                            <!-- Prev/Next Buttons --><button id="carousel-prev" class="absolute left-0 top-1/2 -translate-y-1/2 m-2 p-2 rounded-full bg-white/50 backdrop-blur-sm hover:bg-white/80 transition-all text-primary-navy-DEFAULT">
                                <i data-lucide="chevron-left" class="icon"></i>
                            </button>
                            <button id="carousel-next" class="absolute right-0 top-1/2 -translate-y-1/2 m-2 p-2 rounded-full bg-white/50 backdrop-blur-sm hover:bg-white/80 transition-all text-primary-navy-DEFAULT">
                                <i data-lucide="chevron-right" class="icon"></i>
                            </button>
                        </div>

                        <!-- Thumbnails --><div id="carousel-thumbnails" class="grid grid-cols-4 md:grid-cols-6 gap-2 hidden">
                            <!-- Thumbnails will be injected here by JavaScript --></div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer - Updated text color for readability --><footer class="text-center p-8 text-slate-100 font-semibold">
        <p>See you in Montgomery!</p>
    </footer>

    <!-- ✨ Gemini API Modal --><div id="gemini-modal" class="gemini-modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 opacity-0 pointer-events-none">
        <!-- Updated to rounded-xl and added frosted glass effect --><div class="gemini-modal-content w-full max-w-2xl bg-white/90 backdrop-blur-md rounded-xl shadow-2xl p-6 md:p-8 transform scale-95">
            <!-- Modal Header --><div class="flex justify-between items-center pb-4 border-b border-slate-200">
                <h3 id="modal-title" class="text-2xl font-semibold text-primary">AI Results</h3>
                <button id="modal-close" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>
            </div>
            <!-- Modal Body --><div class="py-6 max-h-[60vh] overflow-y-auto">
                <!-- ✨ New Interactive Prompt Area --><div id="modal-prompt-area" class="hidden space-y-3 mb-4">
                    <label for="modal-prompt-input" class="block text-lg font-semibold text-slate-800">Ask a specific question:</label>
                    <textarea id="modal-prompt-input" rows="3" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none" placeholder="e.g., How should I play the 18th hole?"></textarea>
                    <!-- Button will be themed by CSS --><button id="modal-prompt-submit" class="inline-flex items-center bg-primary text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-primary-dark transition-all">
                        Get Caddy Tip
                    </button>
                </div>

                <!-- Loader --><div id="modal-loader" class="flex justify-center items-center py-10">
                    <div class="loader"></div>
                </div>
                <!-- Content --><div id="gemini-modal-content" class="text-slate-700 text-lg space-y-4 hidden">
                    <!-- AI text will be injected here --></div>
                <!-- Sources --><div id="modal-sources" class="mt-6 hidden">
                    <h4 class="font-semibold text-slate-800">Sources:</h4>
                    <ul id="sources-list" class="list-disc list-inside text-sm text-blue-600 space-y-1">
                        <!-- Sources will be injected here --></ul>
                </div>
            </div>
            <!-- Modal Footer --><div class="flex justify-end pt-4 border-t border-slate-200">
                <!-- Updated close button --><button id="modal-close-footer" class="bg-slate-200 text-slate-800 font-semibold py-2 px-6 rounded-lg hover:bg-slate-300 transition-all">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- This script finds all `data-lucide` icons and renders them --><script>
      lucide.createIcons();
    </script>

    <!-- ✨ Gemini API Integration Script --><!-- ✨ ADDED FIREBASE SDKS -->
    <script type="module">
        // --- ✨ New Firebase SDK Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, query, 
            onSnapshot, serverTimestamp, orderBy 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { 
            getStorage, ref, uploadBytes, getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";


        // --- Wrap all script logic in DOMContentLoaded listener ---
        document.addEventListener('DOMContentLoaded', (event) => {

            let db, storage; // Declare Firebase services in the outer scope

            // --- ✨ New Firebase Initialization ---
            const firebaseConfig = {
              apiKey: "AIzaSyCBFGJJzm9fn1ZphhMZPOjNI_Y07kWWtVw",
              authDomain: "og-weekend-2026.firebaseapp.com",
              projectId: "og-weekend-2026",
              storageBucket: "og-weekend-2026.firebasestorage.app",
              messagingSenderId: "554886174493",
              appId: "1:554886174493:web:79c91d04885f8b450eb3f4"
            };
            
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app); // Assign to outer scope variable
                storage = getStorage(app); // Assign to outer scope variable
                console.log("Firebase Initialized Successfully.");
                // Call the new gallery listener
                initGalleryListener(db);
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
                if (document.getElementById('gallery-placeholder')) {
                    document.getElementById('gallery-placeholder').textContent = "Error: Could not connect to gallery database.";
                    document.getElementById('gallery-placeholder').classList.remove('hidden');
                }
            }


            // Set default theme on load
            document.body.dataset.theme = 'blue';
        
            // --- Modal Elements ---
            const modal = document.getElementById('gemini-modal');
            const modalContent = document.getElementById('gemini-modal-content');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.querySelector('#gemini-modal .py-6'); // Use a more specific selector
            const modalLoader = document.getElementById('modal-loader');
            const modalResultContent = document.getElementById('gemini-modal-content');
            const modalSources = document.getElementById('modal-sources');
            const sourcesList = document.getElementById('sources-list');
            const closeButtons = [document.getElementById('modal-close'), document.getElementById('modal-close-footer')];
            
            // --- Button Elements ---
            const packingListButton = document.getElementById('generate-packing-list');
            const dinnerButton = document.getElementById('generate-dinner-ideas');
            const legislatorCaddyButton = document.getElementById('caddy-legislator');
            const senatorCaddyButton = document.getElementById('caddy-senator');
            
            // --- ✨ New "Ask" Button Elements ---
            const caddyAskLegislatorButton = document.getElementById('caddy-ask-legislator');
            const caddyAskSenatorButton = document.getElementById('caddy-ask-senator');
            
            // --- ✨ New Modal Prompt Elements ---
            const modalPromptArea = document.getElementById('modal-prompt-area');
            const modalPromptInput = document.getElementById('modal-prompt-input');
            const modalPromptSubmit = document.getElementById('modal-prompt-submit');

            // --- ✨ New AI Concierge Elements ---
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const chatSubmit = document.getElementById('chat-submit');

            // --- ✨ Updated Gallery Elements ---
            const carouselImage = document.getElementById('carousel-image');
            const carouselPrev = document.getElementById('carousel-prev');
            const carouselNext = document.getElementById('carousel-next');
            const carouselThumbnails = document.getElementById('carousel-thumbnails');
            const uploadButton = document.getElementById('upload-button');
            const fileInput = document.getElementById('file-input');
            const uploadStatus = document.getElementById('upload-status');
            const galleryPlaceholder = document.getElementById('gallery-placeholder');
            const carouselContainer = document.getElementById('carousel-container');


            // --- ✨ Updated Tab Logic ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');

            console.log("Finding tabs:", tabButtons.length, "buttons,", tabPanels.length, "panels");

            if (tabButtons.length > 0 && tabPanels.length > 0) {
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetPanelId = button.dataset.tabTarget;
                        console.log("Tab clicked. Target:", targetPanelId);

                        // 1. Hide all panels
                        tabPanels.forEach(panel => {
                            panel.classList.add('hidden');
                        });

                        // 2. Show the target panel
                        const targetPanel = document.querySelector(targetPanelId);
                        if (targetPanel) {
                            targetPanel.classList.remove('hidden');
                        }

                        // 3. Update button styles
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active-tab');
                            // Reset to default inactive style
                            btn.classList.add('text-slate-700', 'hover:bg-slate-300');
                            // Remove all possible active colors
                            btn.classList.remove('bg-primary', 'bg-primary-red-DEFAULT', 'bg-primary-green-DEFAULT', 'bg-primary-gold-DEFAULT', 'text-white', 'text-black');
                        });
                        
                        // Add active class to the clicked button
                        button.classList.add('active-tab');
                        button.classList.remove('text-slate-700', 'hover:bg-slate-300');

                        // 4. ✨ Set body theme data-attribute for modal theming
                        if (targetPanelId === '#tools') {
                            document.body.dataset.theme = 'red';
                        } else if (targetPanelId === '#itinerary') {
                            document.body.dataset.theme = 'green';
                        } else if (targetPanelId === '#concierge') {
                            document.body.dataset.theme = 'gold';
                        } else if (targetPanelId === '#gallery') {
                            document.body.dataset.theme = 'navy';
                        } else {
                            document.body.dataset.theme = 'blue';
                        }
                    });
                });
            }
            // --- End of Tab Logic ---


            // --- DEBUGGING: Log elements *inside* the listener ---
            console.log("Finding elements:");
            console.log("modal:", modal);
            console.log("modalTitle:", modalTitle);
            console.log("modalLoader:", modalLoader);
            console.log("packingListButton:", packingListButton);
            console.log("dinnerButton:", dinnerButton);
            console.log("legislatorCaddyButton:", legislatorCaddyButton);
            console.log("senatorCaddyButton:", senatorCaddyButton);
            console.log("caddyAskLegislatorButton:", caddyAskLegislatorButton);
            console.log("caddyAskSenatorButton:", caddyAskSenatorButton);
            console.log("chatMessages:", chatMessages);
            console.log("chatInput:", chatInput);
            console.log("chatSubmit:", chatSubmit);
            console.log("carouselImage:", carouselImage);
            console.log("uploadButton:", uploadButton);


            // --- ✨ RESTORED MODAL FUNCTIONS ---

            // --- Modal Functions ---
            function showModal(title) {
                // Check if elements exist before using them
                if (!modal || !modalTitle || !modalLoader || !modalResultContent || !modalSources) {
                    console.error("showModal: One or more modal elements are null! This shouldn't happen.");
                    return;
                }
                
                console.log("Showing modal with title:", title);
                modalTitle.textContent = title;
                
                // Reset modal state
                modalLoader.classList.remove('hidden');
                modalResultContent.classList.add('hidden');
                modalResultContent.innerHTML = '';
                modalSources.classList.add('hidden');
                sourcesList.innerHTML = '';
                
                // --- ✨ ADDED: Also hide prompt area and reset validation
                modalPromptArea.classList.add('hidden'); 
                modalPromptInput.classList.remove('border-red-500'); 
                modalPromptInput.placeholder = "e.g., How should I play the 18th hole?";

                // Show modal
                modal.classList.remove('opacity-0', 'pointer-events-none');
                // Access the first child 'div' for scaling
                modal.firstElementChild.classList.remove('scale-95');
            }

            function closeTheModal() {
                if (!modal) {
                    console.error("hideModal: modal element is null!");
                    return;
                }
                console.log("Closing modal.");
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.firstElementChild.classList.add('scale-95');
            }

            function showModalContent(text, sources = []) {
                if (!modalLoader || !modalResultContent) {
                    console.error("showModalContent: loader or result content is null!");
                    return;
                }
                modalLoader.classList.add('hidden');
                
                // --- FIX: Add markdown-style bolding ---
                let formattedText = text
                    // 1. Handle bold (**)
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    // 2. Handle bold (*)
                    .replace(/(?<!\w)\*(.*?)\*(?!\w)/g, '<strong>$1</strong>')
                    // 3. Handle newlines
                    .replace(/\n/g, '<br>')
                    // 4. Handle bullet points (* or -) at the start of a "line"
                    .replace(/(<br>|^)(\s*)(\* | - )/g, '$1$2<span class="font-bold text-primary-dark mr-2">•</span>');
                
                modalResultContent.innerHTML = formattedText;
                modalResultContent.classList.remove('hidden');

                if (sources && sources.length > 0) {
                    console.log("Showing sources:", sources);
                    sourcesList.innerHTML = sources.map(source => 
                        `<li><a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="hover:underline">${source.title}</a></li>`
                    ).join('');
                    modalSources.classList.remove('hidden');
                }
            }

            function showModalError(error) {
                if (!modalLoader || !modalResultContent) {
                    console.error("showModalError: loader or result content is null!");
                    return;
                }
                modalLoader.classList.add('hidden');
                
                let errorMessage = "An unknown error occurred. Please try again.";
                if (error instanceof Error) {
                    errorMessage = error.message;
                } else if (typeof error === 'object' && error.message) {
                    errorMessage = error.message;
                } else if (typeof error === 'string') {
                    errorMessage = error;
                }
                
                // Show a user-friendly error in the modal
                modalResultContent.innerHTML = `
                    <div class"text-red-600">
                        <strong class="font-semibold">Oops! Something went wrong:</strong>
                        <p class="mt-2">${errorMessage}</p>
                        <p class="mt-4 text-sm text-slate-600">If this persists, please check the console for more details.</p>
                    </div>
                `;
                modalResultContent.classList.remove('hidden');
                console.error("Error displayed to user:", errorMessage);
            }
            
            // --- ✨ END OF RESTORED MODAL FUNCTIONS ---


            // --- ✨ REBUILT Gallery/Carousel Logic (Firebase-driven) ---
            
            let galleryImages = []; // This will be our local copy of image data from Firestore
            let currentImageIndex = 0;

            /**
             * Updates the main carousel view based on the currentImageIndex
             */
            function updateGalleryView(index) {
                if (!carouselImage || !carouselThumbnails || !carouselContainer || !galleryPlaceholder) return;

                if (galleryImages.length === 0) {
                    // Show placeholder, hide carousel
                    galleryPlaceholder.classList.remove('hidden');
                    carouselContainer.classList.add('hidden');
                    carouselThumbnails.classList.add('hidden');
                    return;
                }
                
                // Show carousel, hide placeholder
                galleryPlaceholder.classList.add('hidden');
                carouselContainer.classList.remove('hidden');
                carouselThumbnails.classList.remove('hidden');

                currentImageIndex = index;
                
                // Fade out image, change src, fade back in
                carouselImage.style.opacity = '0';
                setTimeout(() => {
                    carouselImage.src = galleryImages[currentImageIndex].url;
                    carouselImage.alt = galleryImages[currentImageIndex].name || 'Gallery image';
                    carouselImage.style.opacity = '1';
                }, 300); // Match transition duration

                // Update active thumbnail
                document.querySelectorAll('.carousel-thumbnail').forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === currentImageIndex);
                });
            }

            /**
             * Sets up the real-time listener on the Firestore "gallery" collection
             */
            function initGalleryListener(db) {
                if (!db) {
                    console.error("Firestore DB not initialized. Gallery cannot load.");
                    if (galleryPlaceholder) {
                        galleryPlaceholder.classList.remove('hidden');
                        galleryPlaceholder.textContent = "Error loading gallery: Not connected.";
                    }
                    return;
                }
                console.log("Setting up gallery listener...");
                const galleryRef = collection(db, "gallery");
                // Order by 'createdAt' timestamp, newest first
                const q = query(galleryRef, orderBy("createdAt", "desc"));

                onSnapshot(q, (snapshot) => {
                    console.log("Gallery snapshot received:", snapshot.docs.length, "items.");
                    galleryImages = []; // Clear the local array
                    
                    snapshot.forEach((doc) => {
                        galleryImages.push({ id: doc.id, ...doc.data() });
                    });

                    // Re-populate thumbnails
                    if (carouselThumbnails) {
                        carouselThumbnails.innerHTML = galleryImages.map((image, index) => `
                            <img src="${image.url}" 
                                 alt="${image.name || 'thumbnail'}" 
                                 class="carousel-thumbnail w-full h-auto rounded-lg aspect-video object-cover"
                                 data-index="${index}">
                        `).join('');

                        // Add click listeners to the new thumbnails
                        carouselThumbnails.querySelectorAll('.carousel-thumbnail').forEach(thumb => {
                            thumb.addEventListener('click', () => {
                                updateGalleryView(parseInt(thumb.dataset.index));
                            });
                        });
                    }

                    // Update the main view
                    // If our index is now out of bounds (e.g., photo deleted), reset to 0
                    if (currentImageIndex >= galleryImages.length) {
                        currentImageIndex = 0;
                    }
                    updateGalleryView(currentImageIndex);

                }, (error) => {
                    console.error("Error listening to gallery:", error);
                    if (galleryPlaceholder) {
                        galleryPlaceholder.classList.remove('hidden');
                        galleryPlaceholder.textContent = "Error loading gallery.";
                    }
                });
            }

            // Add Prev/Next listeners
            if (carouselPrev && carouselNext) {
                carouselPrev.addEventListener('click', () => {
                    if (galleryImages.length === 0) return;
                    const newIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
                    updateGalleryView(newIndex);
                });
                carouselNext.addEventListener('click', () => {
                    if (galleryImages.length === 0) return;
                    const newIndex = (currentImageIndex + 1) % galleryImages.length;
                    updateGalleryView(newIndex);
                });
            }

            // --- ✨ New File Upload Logic ---
            
            /**
             * Handles the file selection and upload process
             */
            async function handleFileUpload(event) { // Removed db, storage args
                if (!db || !storage) {
                    console.error("Firebase not initialized. Cannot upload file.");
                    uploadStatus.textContent = "Error: Not connected to Firebase.";
                    return;
                }
                if (!event.target.files || event.target.files.length === 0) return;
                
                const file = event.target.files[0];
                console.log("File selected:", file.name, file.type, file.size);

                // 1. Validation (based on our Storage Rules)
                if (!file.type.startsWith('image/')) {
                    uploadStatus.textContent = "Error: File must be an image.";
                    uploadStatus.classList.add('text-red-500');
                    return;
                }
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    uploadStatus.textContent = "Error: Image must be under 5MB.";
                    uploadStatus.classList.add('text-red-500');
                    return;
                }

                // 2. Show loading state
                uploadStatus.textContent = `Uploading ${file.name}...`;
                uploadStatus.classList.remove('text-red-500');
                uploadButton.disabled = true;

                try {
                    // 3. Create storage reference (e.g., /gallery/1678886400000_my-photo.jpg)
                    const storageRef = ref(storage, `gallery/${new Date().getTime()}_${file.name}`);

                    // 4. Upload file
                    console.log("Uploading to Storage...");
                    const uploadResult = await uploadBytes(storageRef, file);
                    console.log("Upload successful:", uploadResult);

                    // 5. Get download URL
                    const downloadURL = await getDownloadURL(uploadResult.ref);
                    console.log("Got download URL:", downloadURL);

                    // 6. Save URL to Firestore
                    await addDoc(collection(db, "gallery"), {
                        url: downloadURL,
                        name: file.name,
                        createdAt: serverTimestamp() // From firestore import
                    });
                    
                    console.log("Saved to Firestore. Real-time listener will now update the gallery.");
                    uploadStatus.textContent = "Upload complete!";
                    setTimeout(() => { uploadStatus.textContent = ""; }, 3000);

                } catch (error) {
                    console.error("Upload failed:", error);
                    uploadStatus.textContent = "Upload failed. See console for details.";
                    uploadStatus.classList.add('text-red-500');
                } finally {
                    // 7. Reset button and file input
                    uploadButton.disabled = false;
                    fileInput.value = ''; // Clear the file input so user can upload same file again
                }
            }

            // Add listeners for the new upload buttons
            if (uploadButton && fileInput) {
                uploadButton.addEventListener('click', () => {
                    fileInput.click(); // Trigger the hidden file input
                });
                
                // The 'change' event will call handleFileUpload
                fileInput.addEventListener('change', handleFileUpload);
                
            } else {
                console.error("Upload elements not found.");
            }
            
            // --- ✨ End of New Firebase Logic ---


            // --- ✨ New Chat Helper Functions ---

            function addMessageToChat(text, role, sources = []) {
                if (!chatMessages) return;

                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-message');

                if (role === 'user') {
                    messageDiv.classList.add('user-message');
                    messageDiv.textContent = text;
                } else if (role === 'ai') {
                    messageDiv.classList.add('ai-message');
                    let formattedText = text
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/(?<!\w)\*(.*?)\*(?!\w)/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>')
                        .replace(/(<br>|^)(\s*)(\* | - )/g, '$1$2<span class="font-bold text-primary-dark mr-2">•</span>');
                    
                    if (sources && sources.length > 0) {
                        formattedText += '<div class="sources-list">';
                        formattedText += '<h4 class="font-semibold text-slate-800">Sources:</h4>';
                        formattedText += '<ul class="list-disc list-inside text-sm text-blue-600 space-y-1">';
                        formattedText += sources.map(source => 
                            `<li><a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="hover:underline">${source.title}</a></li>`
                        ).join('');
                        formattedText += '</ul></div>';
                    }
                    messageDiv.innerHTML = formattedText;
                } else if (role === 'error') {
                    messageDiv.classList.add('error-message');
                    messageDiv.innerHTML = `<strong>Oops!</strong><br>${text}`;
                } else if (role === 'typing') {
                    messageDiv.classList.add('typing-indicator');
                    messageDiv.textContent = "Concierge is thinking...";
                    messageDiv.id = "typing-indicator"; // So we can find and remove it
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function removeTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }


            // --- Gemini API Call ---
            async function callGeminiAPI(userQuery, systemPrompt, useGrounding = false, retries = 3, delay = 1000) {
                const apiUrl = `/api/gemini`; 
                
                const payload = {
                    userQuery,
                    systemPrompt,
                    useGrounding
                };

                console.log("Sending payload to OUR backend:", payload);

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.text();
                        console.error("Backend Error Response Status:", response.status, "Body:", errorBody);
                        if (response.status === 429 && retries > 0) {
                            console.warn(`Throttled. Retrying in ${delay}ms... (${retries} retries left)`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return await callGeminiAPI(userQuery, systemPrompt, useGrounding, retries - 1, delay * 2);
                        }
                        let serverError = "Server error. Check backend logs.";
                        try {
                            const errorJson = JSON.parse(errorBody);
                            if(errorJson.error) {
                                serverError = errorJson.error;
                            }
                        } catch(e) {
                            serverError = errorBody;
                        }
                        throw new Error(`Backend Error: ${response.status}. ${serverError}`);
                    }

                    const result = await response.json(); 
                    console.log("API Success Response (from our backend):", result);

                    if (result.text) {
                        return { text: result.text, sources: result.sources || [] };
                    } else {
                        console.error("Invalid API response structure from our backend:", result);
                        throw new Error("The backend returned an unexpected response.");
                    }

                } catch (error) {
                    console.error("Backend API call failed:", error);
                    throw error;
                }
            }

            // --- Button Event Listeners ---

            // 1. Packing List Button
            if (packingListButton) {
                packingListButton.addEventListener('click', async () => {
                    console.log("Packing list button clicked.");
                    showModal("✨ AI Packing List");
                    
                    const systemPrompt = "You are a helpful travel assistant. You create concise, bulleted packing lists. Do not add any introductory or concluding text. Just the list.";
                    const userQuery = "Create a packing list for a 4-day golf trip to Montgomery, Alabama in early February. Include golf gear, casual wear for evenings, and essentials. Assume 4 rounds of golf.";

                    try {
                        const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, false);
                        showModalContent(text, sources);
                    } catch (error) {
                        showModalError(error);
                    }
                });
            } else {
                console.error("Packing list button not found. AI feature will not work.");
            }

            // 2. Dinner Ideas Button
            if (dinnerButton) {
                dinnerButton.addEventListener('click', async () => {
                    console.log("Dinner ideas button clicked.");
                    showModal("✨ Dinner Suggestions");
                    
                    const systemPrompt = "You are a local food critic. You give 3-5 interesting dinner recommendations based on real-time search, including the type of cuisine. Format as a bulleted list. Provide sources.";
                    const userQuery = "Find 3-5 good dinner restaurants near downtown Montgomery, Alabama. Good for a group of guys.";

                    try {
                        const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                        showModalContent(text, sources);
                    } catch (error) {
                        showModalError(error);
                    }
                });
            } else {
                console.error("Dinner ideas button not found. AI feature will not work.");
            }

            // 3. Legislator Caddy Button
            if (legislatorCaddyButton) {
                legislatorCaddyButton.addEventListener('click', async () => {
                    console.log("Legislator caddy button clicked.");
                    showModal("✨ Legislator Course Caddy");
                    
                    const systemPrompt = "You are an expert golf caddy. You provide 3-5 key, actionable tips for playing a specific golf course, using real-time search. Focus on signature holes, common hazards, and green-reading advice. Format as a bulleted list.";
                    const userQuery = "Give me 3-5 expert caddy tips for playing the Legislator course at RTJ Capitol Hill in Prattville, AL. What should I look out for?";

                    try {
                        const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                        showModalContent(text, sources);
                    } catch (error) {
                        showModalError(error);
                    }
                });
            } else {
                console.error("Legislator caddy button not found. AI feature will not work.");
            }

            // 4. Senator Caddy Button
            if (senatorCaddyButton) {
                senatorCaddyButton.addEventListener('click', async () => {
                    console.log("Senator caddy button clicked.");
                    showModal("✨ Senator Course Caddy");
                    
                    const systemPrompt = "You are an expert golf caddy. You provide 3-5 key, actionable tips for playing a specific golf course, using real-time search. Focus on signature holes, common hazards, and green-reading advice. Format as a bulleted list.";
                    const userQuery = "Give me 3-5 expert caddy tips for playing the Senator course at RTJ Capitol Hill in Prattville, AL. This is a links-style course. What should I look out for?";

                    try {
                        const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                        showModalContent(text, sources);
                    } catch (error) {
                        showModalError(error);
                    }
                });
            } else {
                console.error("Senator caddy button not found. AI feature will not work.");
            }

            // --- ✨ New Event Listeners for "Ask Caddy" Buttons ---

            // 5. Ask Legislator Caddy Button
            if (caddyAskLegislatorButton) {
                caddyAskLegislatorButton.addEventListener('click', () => {
                    console.log("Ask Legislator Caddy button clicked.");
                    showModal("✨ Ask Legislator Caddy");
                    
                    modalPromptArea.classList.remove('hidden');
                    modalLoader.classList.add('hidden');
                    modalResultContent.classList.add('hidden');
                    modalSources.classList.add('hidden');
                    modalPromptInput.value = '';

                    modalPromptSubmit.onclick = async () => {
                        const userQuery = modalPromptInput.value;
                        if (!userQuery) {
                            modalPromptInput.classList.add('border-red-500', 'placeholder-red-500');
                            modalPromptInput.placeholder = "Please ask a question first!";
                            return;
                        }
                        modalPromptInput.classList.remove('border-red-500', 'placeholder-red-500');
                        modalPromptInput.placeholder = "e.g., How should I play the 18th hole?";

                        modalPromptArea.classList.add('hidden');
                        modalLoader.classList.remove('hidden');

                        const systemPrompt = "You are an expert golf caddy. You answer specific questions about the Legislator course at RTJ Capitol Hill in Prattville, AL. Use real-time search to find info if needed. Be concise.";
                        
                        try {
                            const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                            showModalContent(text, sources);
                        } catch (error) {
                            showModalError(error);
                        }
                    };
                });
            } else {
                console.error("Ask Legislator Caddy button not found.");
            }

            // 6. Ask Senator Caddy Button
            if (caddyAskSenatorButton) {
                caddyAskSenatorButton.addEventListener('click', () => {
                    console.log("Ask Senator Caddy button clicked.");
                    showModal("✨ Ask Senator Caddy");
                    
                    modalPromptArea.classList.remove('hidden');
                    modalLoader.classList.add('hidden');
                    modalResultContent.classList.add('hidden');
                    modalSources.classList.add('hidden');
                    modalPromptInput.value = '';

                    modalPromptSubmit.onclick = async () => {
                        const userQuery = modalPromptInput.value;
                        if (!userQuery) {
                            modalPromptInput.classList.add('border-red-500', 'placeholder-red-500');
                            modalPromptInput.placeholder = "Please ask a question first!";
                            return;
                        }
                        modalPromptInput.classList.remove('border-red-500', 'placeholder-red-500');
                        modalPromptInput.placeholder = "e.g., How should I play the 18th hole?";

                        modalPromptArea.classList.add('hidden');
                        modalLoader.classList.remove('hidden');

                        const systemPrompt = "You are an expert golf caddy. You answer specific questions about the Senator course at RTJ Capitol Hill in Prattville, AL. Use real-time search to find info if needed. Be concise.";
                        
                        try {
                            const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                            showModalContent(text, sources);
                        } catch (error) {
                            showModalError(error);
                        }
                    };
                });
            } else {
                console.error("Ask Senator Caddy button not found.");
            }

            // --- ✨ New AI Concierge Event Listeners ---

            if (chatSubmit && chatInput && chatMessages) {
                chatSubmit.addEventListener('click', handleChatSubmit);
                
                chatInput.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' && !event.shiftKey) {
                        event.preventDefault();
                        handleChatSubmit();
                    }
                });

            } else {
                console.error("AI Concierge chat elements not found.");
            }

            async function handleChatSubmit() {
                const userQuery = chatInput.value.trim();
                if (!userQuery) return;

                addMessageToChat(userQuery, 'user');
                chatInput.value = '';
                chatInput.disabled = true;
                chatSubmit.disabled = true;

                addMessageToChat('Concierge is thinking...', 'typing');

                const systemPrompt = "You are an expert AI concierge for a golf trip to Montgomery, Alabama. You have deep knowledge of the Robert Trent Jones Golf Trail, local restaurants (like Central, Southernish), city history (like the National Memorial for Peace and Justice), and attractions. Answer all questions in a friendly, helpful, and conversational tone. Use search to find up-to-date information.";

                try {
                    const { text, sources } = await callGeminiAPI(userQuery, systemPrompt, true);
                    removeTypingIndicator();
                    addMessageToChat(text, 'ai', sources);
                } catch (error) {
                    removeTypingIndicator();
                    addMessageToChat(error.message, 'error');
                } finally {
                    chatInput.disabled = false;
                    chatSubmit.disabled = false;
                    chatInput.focus();
                }
            }


            // --- Modal Close Listeners ---
            closeButtons.forEach(button => {
                if (button) {
                    button.addEventListener('click', closeTheModal);
                }
            });

            if (modal) {
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        closeTheModal();
                    }
                });
            }
        
        }); // End of DOMContentLoaded listener
    </script>
</body>
</html>

